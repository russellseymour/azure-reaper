<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.85.0" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Subscriptions :: Azure Reaper</title>

    
    <link href="/css/nucleus.css?1625650244" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1625650244" rel="stylesheet">
    <link href="/css/hybrid.css?1625650244" rel="stylesheet">
    <link href="/css/featherlight.min.css?1625650244" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1625650244" rel="stylesheet">
    <link href="/css/auto-complete.css?1625650244" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1625650244" rel="stylesheet">
    <link href="/css/theme.css?1625650244" rel="stylesheet">
    <link href="/css/tabs.css?1625650244" rel="stylesheet">
    <link href="/css/hugo-theme.css?1625650244" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1625650244"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<link rel="stylesheet" href="/css/own.css">
  </head>
  <body class="" data-url="/started/subscriptions/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="/images/azreaper.svg" />
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1625650244"></script>
<script type="text/javascript" src="/js/auto-complete.js?1625650244"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/example.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1625650244"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/started/" title="Getting Started" class="dd-item
        parent
        
        
        ">
      <a href="/started/">
          <i class="fas fa-play"></i> Getting Started
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/started/infrastructure/" title="Infrastructure" class="dd-item ">
        <a href="/started/infrastructure/">
        Infrastructure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/started/settings/" title="Settings" class="dd-item ">
        <a href="/started/settings/">
        Settings
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/started/subscriptions/" title="Subscriptions" class="dd-item active">
        <a href="/started/subscriptions/">
        Subscriptions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/started/tags/" title="Tags" class="dd-item ">
        <a href="/started/tags/">
        Tags
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/maintenance/" title="Maintenance" class="dd-item
        
        
        
        ">
      <a href="/maintenance/">
          <i class="fas fa-cog"></i> Maintenance
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/maintenance/tags/" title="Setting Tags" class="dd-item ">
        <a href="/maintenance/tags/">
        Setting Tags
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/maintenance/upgrade/" title="Function Upgrade" class="dd-item ">
        <a href="/maintenance/upgrade/">
        Function Upgrade
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/api/" title="API" class="dd-item
        
        
        
        ">
      <a href="/api/">
          <i class='fas fa-rocket'></i> API
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/api/authentication/" title="Authentication" class="dd-item ">
        <a href="/api/authentication/">
        Authentication
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/api/swagger/" title="Swagger" class="dd-item ">
        <a href="/api/swagger/">
        Swagger
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Azure Reaper</a> > <a href='/started/'>Getting Started</a> > Subscriptions
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#create-spn">Create SPN</a></li>
    <li><a href="#add-subscription-to-the-api">Add subscription to the API</a></li>
    <li><a href="#subscription-object-properties">Subscription object properties</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Subscriptions
            </h1>
          

        


<h4 id="a-list-of-subscriptions-that-reaper-can-work-on-has-to-be-supplied-this-is-done-by-posting-to-the-api">A list of subscriptions that Reaper can work on has to be supplied. This is done by POST&rsquo;ing to the API.</h4>
<p>In order to Reaper to be able to tag and reap resources, it needs to be able to access the subscription in which the resource group has been created. To do this is needs to have an SPN to login with.</p>

<div class="notices warning" ><p>Currently the SPN details are held in the deployed CosmosDB in clear text. This will be modified in a future release to store such information in a Key Vault</p>
</div>

<h2 id="create-spn">Create SPN</h2>
<p>The easiest way to create the SPN is to use either the Azure CLI or PowerShell.</p>


<div class="tab-panel">
    <div class="tab-nav">
    
        <button
          data-tab-item="Azure CLI"
          data-tab-group="spn"
          class="tab-nav-button btn active"
          onclick="switchTab('spn','Azure CLI')"
         >Azure CLI</button>
    
        <button
          data-tab-item="PowerShell"
          data-tab-group="spn"
          class="tab-nav-button btn "
          onclick="switchTab('spn','PowerShell')"
         >PowerShell</button>
    
    </div>
    <div class="tab-content">
        
        <div data-tab-item="Azure CLI" data-tab-group="spn" class="tab-item active">
            <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">az ad sp create-for-rbac --name AzureReaper
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;appId&#34;</span>: <span style="color:#e6db74">&#34;4703916a-c745-427e-9559-27488be86dfd&#34;</span>,
  <span style="color:#f92672">&#34;displayName&#34;</span>: <span style="color:#e6db74">&#34;AzureReaper&#34;</span>,
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;http://AzureReaper&#34;</span>,
  <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;5lj02Jw1awGO6-UWG.7cLplhxRTeM3Ix0d&#34;</span>,
  <span style="color:#f92672">&#34;tenant&#34;</span>: <span style="color:#e6db74">&#34;f88c76e1-2e79-4cd5-8b37-842f3f870d58&#34;</span>
}
</code></pre></div>
        </div>
        
        <div data-tab-item="PowerShell" data-tab-group="spn" class="tab-item ">
            <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">New-AzADServicePrincipal -DisplayName <span style="color:#e6db74">&#34;AzureReaper&#34;</span>

<span style="color:#75715e"># Output</span>
Secret                <span style="color:#960050;background-color:#1e0010">:</span> System.Security.SecureString
ServicePrincipalNames <span style="color:#960050;background-color:#1e0010">:</span> {41fcd592-5fb9-40a1-a8cc-e0904833edd2, http<span style="color:#960050;background-color:#1e0010">:</span>//AzureReaper}
ApplicationId         <span style="color:#960050;background-color:#1e0010">:</span> 41fcd592-5fb9-40a1-a8cc-e0904833edd2
ObjectType            <span style="color:#960050;background-color:#1e0010">:</span> ServicePrincipal
DisplayName           <span style="color:#960050;background-color:#1e0010">:</span> AzureReaper
Id                    <span style="color:#960050;background-color:#1e0010">:</span> 70a2a996-c2f9-4c03-b6db-aaab36d4b7e1
</code></pre></div>
        </div>
        
    </div>
</div>

<h2 id="add-subscription-to-the-api">Add subscription to the API</h2>
<p>In both cases, the commands above will output information about the SPN that has been created.</p>

<div class="notices tip" ><p>In the following example the SPN created by the <code>az</code> command has been used</p>
</div>

<p>Using a text editor, create a JSON object that will be used to send the data to the API. The JSON object should be similar to the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;RJS Visual Studio Subscription&#34;</span>,
    <span style="color:#f92672">&#34;subscription_id&#34;</span>: <span style="color:#e6db74">&#34;28f3bff4-25d1-4ff1-974b-a48d53929c84&#34;</span>,
    <span style="color:#f92672">&#34;client_id&#34;</span>: <span style="color:#e6db74">&#34;4703916a-c745-427e-9559-27488be86dfd&#34;</span>,
    <span style="color:#f92672">&#34;client_secret&#34;</span>: <span style="color:#e6db74">&#34;5lj02Jw1awGO6-UWG.7cLplhxRTeM3Ix0d&#34;</span>,
    <span style="color:#f92672">&#34;tenant_id&#34;</span>: <span style="color:#e6db74">&#34;f88c76e1-2e79-4cd5-8b37-842f3f870d58&#34;</span>,
    <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;reaper&#34;</span>: <span style="color:#66d9ef">false</span>
}
</code></pre></div><p>Assuming this file has been saved as <code>subscription.json</code> and the API key has been retrieved for <a href="/docs/API/authentication/">Authentication</a>, the command to add to the API is as follows</p>


<div class="tab-panel">
    <div class="tab-nav">
    
        <button
          data-tab-item="Curl"
          data-tab-group="addSubscription"
          class="tab-nav-button btn active"
          onclick="switchTab('addSubscription','Curl')"
         >Curl</button>
    
        <button
          data-tab-item="PowerShell"
          data-tab-group="addSubscription"
          class="tab-nav-button btn "
          onclick="switchTab('addSubscription','PowerShell')"
         >PowerShell</button>
    
    </div>
    <div class="tab-content">
        
        <div data-tab-item="Curl" data-tab-group="addSubscription" class="tab-item active">
            <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -H <span style="color:#e6db74">&#34;x-functions-key: functiontoken123!&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>     -X POST <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>     -d @subscription.json <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>     https://azure-reaper.azurewebsites.net/ops/subscription
</code></pre></div>
        </div>
        
        <div data-tab-item="PowerShell" data-tab-group="addSubscription" class="tab-item ">
            <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Invoke-RestMethod -Method POST `
                  -Headers @{<span style="color:#e6db74">&#34;x-functions-key&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#e6db74">&#34;functiontoken123!&#34;</span>} `
                  -Body (Get-Content -Path subscription.json -raw) `
                  -Uri https<span style="color:#960050;background-color:#1e0010">:</span>//azure-reaper.azurewebsites.net/ops/subscription
</code></pre></div>
        </div>
        
    </div>
</div>

<h2 id="subscription-object-properties">Subscription object properties</h2>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>Name of the subscription as referred to in Reaper</td>
</tr>
<tr>
<td>subscription_id</td>
<td>ID of the subscription that is to be managed</td>
</tr>
<tr>
<td>client_id</td>
<td>App ID of the SPN that has been created</td>
</tr>
<tr>
<td>client_secret</td>
<td>Secret associated with the specified App ID</td>
</tr>
<tr>
<td>tenant_id</td>
<td>Azure tenant that the subscription belongs to</td>
</tr>
<tr>
<td>enabled</td>
<td>Whether reaper is enabled, when set to <code>true</code> auto tagging will work</td>
</tr>
<tr>
<td>reaper</td>
<td>State if the reaping option should be enabled</td>
</tr>
</tbody>
</table>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/started/settings/" title="Settings"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/started/tags/" title="Tags" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1625650244"></script>
    <script src="/js/perfect-scrollbar.min.js?1625650244"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1625650244"></script>
    <script src="/js/jquery.sticky.js?1625650244"></script>
    <script src="/js/featherlight.min.js?1625650244"></script>
    <script src="/js/highlight.pack.js?1625650244"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1625650244"></script>
    <script src="/js/learn.js?1625650244"></script>
    <script src="/js/hugo-learn.js?1625650244"></script>
    
        
            <script src="/mermaid/mermaid.js?1625650244"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

